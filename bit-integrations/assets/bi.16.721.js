var M=Object.defineProperty;var N=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var F=(i,r,e)=>r in i?M(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e,p=(i,r)=>{for(var e in r||(r={}))T.call(r,e)&&F(i,e,r[e]);if(N)for(var e of N(r))L.call(r,e)&&F(i,e,r[e]);return i};import{f as _,j as t,L as k}from"./main-183.js";import{x as q}from"./bi.554.440.js";import{c as y,_ as l,e as $}from"./bi.430.0.js";import{a as V,h as I,b as R}from"./bi.159.3.js";import{T as D,b as O}from"./bi.12.11.js";import{T as U}from"./bi.251.688.js";const B=(i,r,e,s,d)=>{s(!0),y({},"refresh_news_letter").then(n=>{if(n&&n.success){const c=p({},r);c.default||(c.default={}),n.data.newsletterList&&(c.default.newsletterList=n.data.newsletterList),d({show:!0,msg:l("Newsletter list refreshed","bit-integrations")}),e(p({},c))}else n&&n.data&&n.data.data||!n.success&&typeof n.data=="string"?d({show:!0,msg:`${l("Newsletter list refresh failed Cause:","bit-integrations")}${n.data.data||n.data}. ${l("please try again","bit-integrations")}`}):d({show:!0,msg:l("Newsletter list refresh failed. please try again","bit-integrations")});s(!1)}).catch(()=>s(!1))},H=(i,r,e,s)=>{y({},"mail_poet_list_headers").then(d=>{if(d&&d.success){const n=p({},i);if(d.data.mailPoetFields){n.default.fields=d.data.mailPoetFields;const{fields:c}=n.default;n.field_map=Object.values(c).filter(b=>b.required).map(b=>({formField:"",mailPoetField:b.id,required:!0})),s({show:!0,msg:l("Mailpoet fields refreshed","bit-integrations")})}else s({show:!0,msg:l("No Mailpoet fields found. Try changing the header row number or try again","bit-integrations")});d.data.tokenDetails&&(n.tokenDetails=d.data.tokenDetails),r(p({},n))}else s({show:!0,msg:l("Mailpoet fields refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},X=(i,r,e)=>{const s=p({},r);s.name=i.target.value,e(p({},s))},Y=i=>!((i!=null&&i.field_map?i.field_map.filter(e=>!e.formField&&e.mailPoetField&&e.required):[]).length>0);function S({i,formFields:r,field:e,mailPoetConf:s,setMailPoetConf:d}){var j,f,w,v;const n=e.required,c=((j=s==null?void 0:s.default)==null?void 0:j.fields)&&Object.values((f=s==null?void 0:s.default)==null?void 0:f.fields).filter(a=>a.required===""),b=_($),{isPro:h}=b,u=a=>{const o=p({},s);o.field_map.splice(a,0,{}),d(o)},m=a=>{const o=p({},s);o.field_map.length>1&&o.field_map.splice(a,1),d(o)},x=(a,o)=>{const g=p({},s);g.field_map[o][a.target.name]=a.target.value,a.target.value==="custom"&&(g.field_map[o].customValue=""),d(g)};return t.jsxs("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:[t.jsxs("div",{className:"flx integ-fld-wrp",children:[t.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:e.formField||"",onChange:a=>x(a,i),children:[t.jsx("option",{value:"",children:l("Select Field","bit-integrations")}),t.jsx("optgroup",{label:l("Form Fields","bit-integrations"),children:r==null?void 0:r.map(a=>t.jsx("option",{value:a.name,children:a.label},`ff-rm-${a.name}`))}),t.jsx("option",{value:"custom",children:l("Custom...","bit-integrations")}),t.jsx("optgroup",{label:`${l("General Smart Codes","bit-integrations")} ${h?"":`(${l("Pro","bit-integrations")})`}`,children:h&&((w=V)==null?void 0:w.map(a=>t.jsx("option",{value:a.name,children:a.label},`ff-rm-${a.name}`)))})]}),e.formField==="custom"&&t.jsx(U,{onChange:a=>I(a,i,s,d),label:l("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:e.customValue,placeholder:l("Custom Value","bit-integrations"),formFields:r}),t.jsxs("select",{className:"btcd-paper-inp",name:"mailPoetField",value:e.mailPoetField,onChange:a=>x(a,i),disabled:n,children:[t.jsx("option",{value:"",children:l("Select Field","bit-integrations")}),n?((v=s==null?void 0:s.default)==null?void 0:v.fields)&&Object.values(s.default.fields).map(a=>t.jsx("option",{value:a.id,children:a.name},`${a.id}-1`)):c&&c.map(a=>t.jsx("option",{value:a.id,children:a.name},`${a.id}-1`))]})]}),!n&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>u(i),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),t.jsx("button",{onClick:()=>m(i),className:"icn-btn sh-sm ml-2",type:"button","aria-label":"btn",children:t.jsx(D,{})})]})]})}function A({mailPoetConf:i,setMailPoetConf:r}){var n;const e=_($),{isPro:s}=e,d=(c,b)=>{const h=p({},i);b==="update"&&(c.target.checked?h.actions.update=!0:delete h.actions.update),r(p({},h))};return t.jsx("div",{className:"pos-rel d-flx w-8",children:t.jsx(O,{checked:((n=i.actions)==null?void 0:n.update)||!1,onChange:c=>d(c,"update"),className:"wdt-200 mt-4 mr-2",value:"user_share",isInfo:!s,title:`${l("Update Subscriber","bit-integrations")} ${s?"":`(${l("Pro","bit-integrations")})`}`,subTitle:s?l("Update Mailpoet exist Subscriber? First name, last name, and email may not be updated.","bit-integrations"):sprintf(l("The Bit Integration Pro v(%s) or above plugin needs to be installed and activated to enable the %s feature","bit-integrations"),"2.4.1",l("Update Subscriber","bit-integrations"))})})}function Z({formID:i,formFields:r,mailPoetConf:e,setMailPoetConf:s,isLoading:d,setIsLoading:n,setSnackbar:c}){var h;const b=u=>{const m=p({},e);u?(m.lists=u?u.split(","):[],H(m,s,n,c)):delete m.lists,s(p({},m))};return t.jsxs(t.Fragment,{children:[t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:l("List:","bit-integrations")}),t.jsx(q,{defaultValue:e==null?void 0:e.lists,className:"btcd-paper-drpdwn w-6",options:((h=e==null?void 0:e.default)==null?void 0:h.newsletterList)&&Object.keys(e.default.newsletterList).map(u=>({label:e.default.newsletterList[u].newsletterName,value:e.default.newsletterList[u].newsletterId})),onChange:u=>b(u)}),t.jsx("button",{onClick:()=>B(i,e,s,n,c),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${l("Refresh MailPoet List","bit-integrations")}'`},type:"button",disabled:d,children:"â†»"})]}),d&&t.jsx(k,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),(e==null?void 0:e.lists)&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mt-4",children:t.jsx("b",{className:"wdt-100",children:l("Map Fields","bit-integrations")})}),t.jsx("div",{className:"btcd-hr mt-1"}),t.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:l("Form Fields","bit-integrations")})}),t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:l("MailPoet Fields","bit-integrations")})})]}),e.field_map.map((u,m)=>t.jsx(S,{i:m,field:u,mailPoetConf:e,formFields:r,setMailPoetConf:s},`mailpoet-m-${m+9}`)),t.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",children:t.jsx("button",{onClick:()=>R(e.field_map.length,e,s),className:"icn-btn sh-sm",type:"button",children:"+"})}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(A,{mailPoetConf:e,setMailPoetConf:s,formFields:r})]})]})}export{Z as M,Y as c,X as h,B as r};
