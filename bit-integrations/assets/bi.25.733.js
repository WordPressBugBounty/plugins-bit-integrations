var E=Object.defineProperty,P=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var $=(l,r,e)=>r in l?E(l,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[r]=e,h=(l,r)=>{for(var e in r||(r={}))B.call(r,e)&&$(l,e,r[e]);if(T)for(var e of T(r))D.call(r,e)&&$(l,e,r[e]);return l},g=(l,r)=>P(l,H(r));import{r as G,f as O,j as s,L as w}from"./main-183.js";import{u as N,x as I}from"./bi.554.440.js";import{c as M,_ as i,e as V}from"./bi.430.0.js";import{a as L,h as S,b as U}from"./bi.159.3.js";import{b as R,T as z}from"./bi.12.11.js";import{a as J}from"./bi.929.9.js";import{T as K}from"./bi.251.688.js";const k=(l,r,e,c,n,m)=>{n(g(h({},c),{fluentCrmList:!0})),M({},"refresh_fluent_crm_lists").then(a=>{a&&a.success?(e(o=>N(o,p=>{p.fluentCrmList=a.data.fluentCrmList,p.fluentCrmTags=a.data.fluentCrmTags})),m({show:!0,msg:i("FluentCRM list refreshed","bit-integrations")})):a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?m({show:!0,msg:`${i("FluentCRM list refresh failed Cause:","bit-integrations")}${a.data.data||a.data}. ${i("please try again","bit-integrations")}`}):m({show:!0,msg:i("FluentCRM list refresh failed. please try again","bit-integrations")}),n(g(h({},c),{fluentCrmList:!1}))}).catch(()=>n(g(h({},c),{fluentCrmTags:!0})))},A=(l,r,e,c,n,m)=>{n(g(h({},c),{fluentCrmTags:!0})),M({},"refresh_fluent_crm_tags").then(a=>{a&&a.success?(e(o=>N(o,p=>{p.default||(p.default={}),a.data.fluentCrmTags&&(p.fluentCrmTags=a.data.fluentCrmTags)})),m({show:!0,msg:i("FluentCRM Tags refreshed","bit-integrations")})):a&&a.data&&a.data.data||!a.success&&typeof a.data=="string"?m({show:!0,msg:`${i("FluentCRM tags refresh failed Cause:","bit-integrations")}${a.data.data||a.data}. ${i("please try again","bit-integrations")}`}):m({show:!0,msg:i("FluentCRM tags refresh failed. please try again","bit-integrations")}),n(g(h({},c),{fluentCrmTags:!1}))}).catch(()=>n(g(h({},c),{fluentCrmTags:!1})))},Q=(l,r,e,c)=>{e(!0),M({},"fluent_crm_headers").then(n=>{n&&n.success?n.data.fluentCrmFlelds?(r(m=>N(m,a=>{a.fluentCrmFlelds=n.data.fluentCrmFlelds,a.field_map=W(a)})),c({show:!0,msg:i("Fluent CRM fields refreshed","bit-integrations")})):c({show:!0,msg:i("No Fluent CRM fields found. Try changing the header row number or try again","bit-integrations")}):c({show:!0,msg:i("Fluent CRM fields refresh failed. please try again","bit-integrations")}),e(!1)}).catch(()=>e(!1))},q=(l,r,e,c,n)=>{c(g(h({},e),{company:!0})),M({},"fluent_crm_get_all_company").then(m=>{if(c(g(h({},e),{company:!1})),m.success&&(m!=null&&m.data)){r(a=>N(a,o=>{o.companies=m.data})),n({show:!0,msg:i("Fluent CRM Companies refreshed","bit-integrations")});return}n({show:!0,msg:i("Fluent CRM Companies refresh failed. please try again","bit-integrations")})})},W=l=>{const{field_map:r}=l,{fluentCrmFlelds:e}=l,n=Object.values(e).filter(o=>o.required).map(o=>({formField:"",fluentCRMField:o.key,required:!0})).filter(o=>!r.find(p=>p.fluentCRMField===o.fluentCRMField)),a=r.filter(o=>o.fluentCRMField||o.formField).map(o=>{const p=e[o.fluentCRMField];return p?g(h({},o),{formField:p.label}):o});return[...n,...a]},le=(l,r,e)=>{const c=h({},r);c.name=l.target.value,e(h({},c))},ce=l=>!((l!=null&&l.field_map?l.field_map.filter(e=>!e.formField&&e.fluentCRMField&&e.required):[]).length>0);function X({fluentCrmConf:l,setFluentCrmConf:r,loading:e,setLoading:c,setSnackbar:n}){var j,y,t,d,x;const[m,a]=G.useState({show:!1}),o=O(V),{isPro:p}=o,u=(b,F)=>{const _=h({},l);F==="exists"&&(b.target.checked?_.actions.skip_if_exists=!0:delete _.actions.skip_if_exists),F==="doubleOpIn"&&(b.target.checked?_.actions.double_opt_in=!0:delete _.actions.double_opt_in),F==="company_id"&&(a({show:"company_id"}),q(l,r,e,c,n)),F==="company"&&(_.actions.company_id=b),r(h({},_))},v=()=>{a({show:!1})};return s.jsxs("div",{className:"pos-rel d-flx w-8",children:[s.jsx(R,{checked:((j=l.actions)==null?void 0:j.skip_if_exists)||!1,onChange:b=>u(b,"exists"),className:"wdt-200 mt-4 mr-2",value:"skip_if_exists",title:i("Skip exist Contact","bit-integrations"),subTitle:i("Skip if contact already exist in FluentCRM","bit-integrations")}),s.jsx(R,{checked:((y=l.actions)==null?void 0:y.double_opt_in)||!1,onChange:b=>u(b,"doubleOpIn"),className:"wdt-200 mt-4 mr-2",value:"double_opt_in",title:i("Double Opt-in","bit-integrations"),subTitle:i("Enable Double Option for new contacts","bit-integrations")}),s.jsx(R,{checked:((t=l.actions)==null?void 0:t.company_id)||!1,onChange:b=>u(b,"company_id"),className:"wdt-200 mt-4 mr-2",value:"company_id",isInfo:!p,title:`${i("Assign Company","bit-integrations")} ${p?"":"(Pro)"}`,subTitle:p?i("Assign Company for contact","bit-integrations"):sprintf(i("The Bit Integration Pro v(%s) plugin needs to be installed and activated to enable the %s feature","bit-integrations"),"2.3.8",i("Assign Company","bit-integrations"))}),p&&s.jsxs(J,{className:"custom-conf-mdl",mainMdlCls:"o-v",btnClass:"purple",btnTxt:i("Ok","bit-integrations"),show:m.show==="company_id",close:v,action:v,title:i("Assign Company","bit-integrations"),children:[s.jsx("div",{className:"btcd-hr mt-2 mb-2"}),s.jsx("div",{className:"mt-2",children:i("Select Company","bit-integrations")}),e!=null&&e.company?s.jsx(w,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:45,transform:"scale(0.5)"}}):s.jsxs("div",{className:"flx flx-center mt-2",children:[s.jsx(I,{options:(l==null?void 0:l.companies)&&l.companies.map(b=>({label:b.label,value:b.id.toString()})),className:"msl-wrp-options",defaultValue:((x=(d=l.actions)==null?void 0:d.company_id)==null?void 0:x.toString())||"",onChange:b=>u(b,"company"),singleSelect:!0,selectOnClose:!0}),s.jsx("button",{onClick:()=>q(l,r,e,c,n),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${i("Refresh Companies","bit-integrations")}'`},type:"button",disabled:e==null?void 0:e.company,children:"↻"})]})]})]})}function Y({i:l,formFields:r,field:e,fluentCrmConf:c,setFluentCrmConf:n}){var y;const m=e.required,a=(c==null?void 0:c.fluentCrmFlelds)&&Object.values(c==null?void 0:c.fluentCrmFlelds).filter(t=>!t.required),o=O(V),{isPro:p}=o,u=t=>{const d=h({},c);d.field_map.splice(t,0,{}),n(d)},v=t=>{const d=h({},c);d.field_map.length>1&&d.field_map.splice(t,1),n(d)},j=(t,d)=>{const x=h({},c);x.field_map[d][t.target.name]=t.target.value,t.target.value==="custom"&&(x.field_map[d].customValue=""),n(x)};return s.jsxs("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:[s.jsxs("div",{className:"flx integ-fld-wrp",children:[s.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:e.formField||"",onChange:t=>j(t,l),children:[s.jsx("option",{value:"",children:i("Select Field","bit-integrations")}),s.jsx("optgroup",{label:i("Form Fields","bit-integrations"),children:r==null?void 0:r.map(t=>s.jsx("option",{value:t.name,children:t.label},`ff-rm-${t.name}`))}),s.jsx("option",{value:"custom",children:i("Custom...","bit-integrations")}),s.jsx("optgroup",{label:`${i("General Smart Codes","bit-integrations")} ${p?"":`(${i("Pro","bit-integrations")})`}`,children:p&&((y=L)==null?void 0:y.map(t=>s.jsx("option",{value:t.name,children:t.label},`ff-rm-${t.name}`)))})]}),e.formField==="custom"&&s.jsx(K,{onChange:t=>S(t,l,c,n),label:i("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:e.customValue,placeholder:i("Custom Value","bit-integrations"),formFields:r}),s.jsxs("select",{className:"btcd-paper-inp",name:"fluentCRMField",value:e.fluentCRMField,onChange:t=>j(t,l),disabled:m,children:[s.jsx("option",{value:"",children:i("Select Field","bit-integrations")}),m?c.fluentCrmFlelds&&Object.values(c.fluentCrmFlelds).map(t=>s.jsx("option",{value:t.key,children:t.label},`${t.key}-1`)):a&&a.map(t=>s.jsx("option",{value:t.key,children:t.label},`${t.key}-1`))]})]}),!m&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>u(l),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),s.jsx("button",{onClick:()=>v(l),className:"icn-btn sh-sm ml-2",type:"button","aria-label":"btn",children:s.jsx(z,{})})]})]})}function de({formID:l,formFields:r,fluentCrmConf:e,setFluentCrmConf:c,isLoading:n,setIsLoading:m,loading:a,setLoading:o,setSnackbar:p}){const u=t=>{const d=h({},e);t?d.tags=t?t.split(","):[]:delete d.tags,c(h({},d))},v=[{value:"add-tag",label:i("Add tag to a user","bit-integrations")},{value:"remove-tag",label:i("Remove tag from a user","bit-integrations")},{value:"add-user",label:i("Add user to a list","bit-integrations")},{value:"remove-user",label:i("Remove user from a list","bit-integrations")}],j=t=>{const d=h({},e);d.list_id=t.target.value,c(h({},d))},y=t=>{const d=h({},e),{name:x,value:b}=t.target;d==null||delete d.fluentCrmList,d==null||delete d.fluentCrmTags,t.target.value!==""?(d[x]=b,Q(d,c,m,p),b==="add-user"||b==="remove-user"?k(l,d,c,a,o,p):A(l,d,c,a,o,p)):delete d[x],c(d)};return s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsxs("div",{className:"flx",children:[s.jsx("b",{className:"wdt-200 d-in-b",children:i("Action:","bit-integrations")}),s.jsxs("select",{onChange:y,name:"actionName",value:e==null?void 0:e.actionName,className:"btcd-paper-inp w-5",children:[s.jsx("option",{value:"",children:i("Select Action","bit-integrations")}),v.map(({label:t,value:d})=>s.jsx("option",{value:d,children:t},t))]})]}),s.jsx("br",{}),(a.fluentCrmList||a.fluentCrmTags)&&s.jsx(w,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),((e==null?void 0:e.actionName)==="add-user"||(e==null?void 0:e.actionName)==="remove-user")&&(e==null?void 0:e.fluentCrmList)&&!a.fluentCrmList&&s.jsxs("div",{className:"flx",children:[s.jsx("b",{className:"wdt-200 d-in-b",children:i("Fluent CRM List:","bit-integrations")}),s.jsxs("select",{onChange:t=>j(t),name:"list_id",value:e.list_id,className:"btcd-paper-inp w-5",children:[s.jsx("option",{value:"",children:i("Select Fluent CRM list","bit-integrations")}),(e==null?void 0:e.fluentCrmList)&&Object.keys(e.fluentCrmList).map(t=>s.jsx("option",{value:e.fluentCrmList[t].id,children:e.fluentCrmList[t].title},t))]}),s.jsx("button",{onClick:()=>k(l,e,c,a,o,p),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${i("Refresh List, Tag & Field","bit-integrations")}'`},type:"button",disabled:n,children:"↻"})]}),(e==null?void 0:e.actionName)&&(e==null?void 0:e.actionName)!=="remove-user"&&(e==null?void 0:e.fluentCrmTags)&&!a.fluentCrmTags&&s.jsxs("div",{className:"flx mt-5",children:[s.jsx("b",{className:"wdt-200 d-in-b",children:i("Fluent CRM Tags:","bit-integrations")}),s.jsx(I,{defaultValue:e==null?void 0:e.tags,className:"btcd-paper-drpdwn w-5",options:(e==null?void 0:e.fluentCrmTags)&&Object.keys(e.fluentCrmTags).map(t=>({label:e.fluentCrmTags[t].title,value:e.fluentCrmTags[t].id.toString()})),onChange:t=>u(t)}),s.jsx("button",{onClick:()=>A(l,e,c,a,o,p),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${i("Refresh Tag & Field","bit-integrations")}'`},type:"button",disabled:n,children:"↻"})]}),n&&s.jsx(w,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),(e==null?void 0:e.actionName)&&!n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-4",children:s.jsx("b",{className:"wdt-100",children:i("Map Fields","bit-integrations")})}),s.jsx("div",{className:"btcd-hr mt-1"}),s.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:i("Form Fields","bit-integrations")})}),s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:i("Fluent CRM Fields","bit-integrations")})})]}),e.field_map.map((t,d)=>s.jsx(Y,{i:d,field:t,fluentCrmConf:e,formFields:r,setFluentCrmConf:c},`fluentcrm-m-${d+9}`)),s.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",style:{marginRight:85},children:s.jsx("button",{onClick:()=>U(e.field_map.length,e,c),className:"icn-btn sh-sm",type:"button",children:"+"})})]}),(e==null?void 0:e.actionName)==="add-user"&&s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsx("div",{className:"mt-4",children:s.jsx("b",{className:"wdt-100",children:i("Utilities","bit-integrations")})}),s.jsx("div",{className:"btcd-hr mt-1"}),s.jsx(X,{fluentCrmConf:e,setFluentCrmConf:c,loading:a,setLoading:o,setSnackbar:p})]})]})}export{de as F,ce as c,le as h};
