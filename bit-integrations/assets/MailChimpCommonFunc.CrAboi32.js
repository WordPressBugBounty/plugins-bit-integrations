var A=Object.defineProperty,$=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var I=(a,e,t)=>e in a?A(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,u=(a,e)=>{for(var t in e||(e={}))R.call(e,t)&&I(a,t,e[t]);if(y)for(var t of y(e))q.call(e,t)&&I(a,t,e[t]);return a},p=(a,e)=>$(a,k(e));import{_ as l,d as _,s as b}from"./main.2.7.9.js";import{u as F}from"./Note.B1QjZ60t.js";const O=(a,e,t,r,n,c,i,d,s,h,g)=>{t(o=>F(o,f=>{f[a.target.name]=a.target.value,a.target.name==="module"&&a.target.value&&v(r,e,t,d,i),a.target.name==="listId"&&a.target.value||a.target.name==="module"&&a.target.value==="add_a_member_to_an_audience"?(D(r,f,t,i,n,c),S(r,f,t,i,n,c)):a.target.value||(f.field_map=[{formField:"",mailChimpField:""}])}))},U=a=>!((a!=null&&a.address_field?a.address_field.filter(t=>!t.formField&&t.mailChimpAddressField&&t.required):[]).length>0),W=(a,e,t)=>{e(!0),_(null,"mChimp_refresh_modules").then(r=>{r&&r.success?(a(n=>F(n,c=>{c.moduleLists=r.data})),t({show:!0,msg:l("Module list refreshed","bit-integrations")})):t({show:!0,msg:l("Module Not Found!","bit-integrations")}),e(!1)}).catch(r=>e(!1))},v=(a,e,t,r,n)=>{r(!0);const c={formID:a,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};_(c,"mChimp_refresh_audience").then(i=>{i&&i.success?(t(d=>F(d,s=>{s.default||(s.default={}),i.data.audiencelist&&(s.default.audiencelist=i.data.audiencelist),i.data.tokenDetails&&(s.tokenDetails=i.data.tokenDetails)})),n({show:!0,msg:l("Audience list refreshed","bit-integrations")})):i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?n({show:!0,msg:b(l("Audience list refresh failed Cause: %s. please try again","bit-integrations"),i.data.data||i.data)}):n({show:!0,msg:l("Audience list failed. please try again","bit-integrations")}),r(!1)}).catch(()=>r(!1))},D=(a,e,t,r,n,c)=>{c(p(u({},n),{tags:!0}));const i={formID:a,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails,listId:e.listId};_(i,"mChimp_refresh_tags").then(d=>{d&&d.success?t(s=>F(s,h=>{d.data.audienceTags&&(h.default.audienceTags=d.data.audienceTags),r({show:!0,msg:l("Audience tags refreshed","bit-integrations")})})):d&&d.data&&d.data.data||!d.success&&typeof d.data=="string"?r({show:!0,msg:b(l("Audience tags refresh failed Cause: %s. please try again","bit-integrations"),d.data.data||d.data)}):r({show:!0,msg:l("Audience tags failed. please try again","bit-integrations")}),c(p(u({},n),{tags:!1}))}).catch(()=>c(p(u({},n),{tags:!1})))},S=(a,e,t,r,n,c)=>{const{listId:i}=e;if(!i)return;c(p(u({},n),{refreshFields:!0}));const d={formID:a,listId:i,module:e==null?void 0:e.module,clientId:e.clientId,clientSecret:e.clientSecret,tokenDetails:e.tokenDetails};_(d,"mChimp_refresh_fields").then(s=>{s&&s.success?t(h=>F(h,g=>{s.data.audienceField&&(g.default.fields||(g.default.fields={}),g.default.fields[i]=s.data.audienceField,g.field_map=z(s.data.audienceField)),s.data.tokenDetails&&(g.tokenDetails=s.data.tokenDetails),r({show:!0,msg:l("Fields refreshed","bit-integrations")})})):r({show:!0,msg:l("Fields refresh failed. please try again","bit-integrations")}),c(p(u({},n),{refreshFields:!1}))}).catch(()=>c(p(u({},n),{refreshFields:!1})))},J=a=>{const e={},r=window.location.href.replace(`${window.opener.location.href}`,"").split("&");r&&r.forEach(n=>{const c=n.split("=");c[1]&&(e[c[0]]=c[1])}),localStorage.setItem(`__${a}`,JSON.stringify(e)),window.close()},j=(a,e,t,r,n,c,i,d)=>{if(!t.clientId||!t.clientSecret){n({clientId:t.clientId?"":l("Client Id can't be empty","bit-integrations"),clientSecret:t.clientSecret?"":l("Secret key can't be empty","bit-integrations")});return}i(!0);const s=`https://login.mailchimp.com/oauth2/authorize?client_id=${t.clientId}&redirect_uri=${encodeURIComponent(window.location.href)}&response_type=code`,h=window.open(s,a,"width=400,height=609,toolbar=off"),g=setInterval(()=>{if(h.closed){clearInterval(g);let o={},f=!1;const m=localStorage.getItem(`__${a}`);if(m&&(f=!0,o=JSON.parse(m),localStorage.removeItem(`__${a}`),o.code.search("#"))){const[w]=o.code.split("#");o.code=w}if(!o.code||o.error||!o||!f){const w=o.error?`Cause: ${o.error}`:"";d({show:!0,msg:`${l("Authorization failed","bit-integrations")} ${w}. ${l("please try again","bit-integrations")}`}),i(!1)}else{const w=u({},t);w.accountServer=o["accounts-server"],M(e,o,w,r,c,i,d)}}},500)},M=(a,e,t,r,n,c,i)=>{const d=u({},e);d.clientId=t.clientId,d.clientSecret=t.clientSecret,d.redirectURI=window.location.href,_(d,`${a}_generate_token`).then(s=>s).then(s=>{if(s&&s.success){const h=u({},t);h.tokenDetails=s.data,r(h),n(!0),i({show:!0,msg:l("Authorized Successfully","bit-integrations")})}else s&&s.data&&s.data.data||!s.success&&typeof s.data=="string"?i({show:!0,msg:`${l("Authorization failed Cause:","bit-integrations")}${s.data.data||s.data}. ${l("please try again","bit-integrations")}`}):i({show:!0,msg:l("Authorization failed. please try again","bit-integrations")});c(!1)})},x=a=>!((a.field_map?a.field_map.filter(t=>!t.formField||!t.mailChimpField):[]).length>0),z=a=>{const e=a&&Object.values(a).filter(t=>t.required===!0);return e.length>0?e.map(t=>({formField:"",mailChimpField:t.tag})):[{formField:"",mailChimpField:""}]};export{v as a,D as b,x as c,S as d,j as e,U as f,O as h,W as r,J as s};
