var _=Object.defineProperty;var u=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var w=(e,t,a)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,d=(e,t)=>{for(var a in t||(t={}))k.call(t,a)&&w(e,a,t[a]);if(u)for(var a of u(t))b.call(t,a)&&w(e,a,t[a]);return e};import{_ as l,c as p,s as y}from"./bi.964.0.js";import{u as $}from"./bi.89.470.js";const D=(e,t,a,o,r,i,s,n,h)=>{let c=d({},t);if(s){const g=d({},n);g[e.target.name]="",h(d({},g))}switch(c[e.target.name]=e.target.value,e.target.name==="id"&&I(c,a,r,i),e.target.name){case"spreadsheetId":c=spreadSheetChange(c,o,a,r,i);break;case"worksheetName":c=worksheetChange(c,o,a,r,i);break}a(d({},c))},q=e=>{const t={},o=window.location.href.replace(`${window.opener.location.href}`,"").split("&");o&&o.forEach(r=>{const i=r.split("=");i[1]&&(t[i[0]]=i[1])}),localStorage.setItem(`__${e}`,JSON.stringify(t)),window.close()},v=(e,t,a,o,r)=>{o(!0);const i={formID:e,clientId:t.clientId,accessToken:t.tokenDetails.access_token,clientSecret:t.clientSecret,refreshToken:t.tokenDetails.refresh_token,tokenDetails:t.tokenDetails};p(i,"zoom_fetch_all_meetings").then(s=>{if(s&&s.success){const n=d({},t);n.default||(n.default={}),s.data.allMeeting&&(n.default.allMeeting=s.data.allMeeting),r({show:!0,msg:l("Meeting list refreshed","bit-integrations")}),a(d({},n))}else s&&s.data&&s.data.data||!s.success&&typeof s.data=="string"?r({show:!0,msg:y(l("All Meeting list refresh failed Cause: %s. please try again","bit-integrations"),s.data.data||s.data)}):r({show:!0,msg:l("All Meeting list failed. please try again","bit-integrations")});o(!1)}).catch(()=>o(!1))},I=(e,t,a,o)=>{a(!0);const r={meetingId:e.id,clientId:e.clientId,accessToken:e.tokenDetails.access_token,clientSecret:e.clientSecret,refreshToken:e.tokenDetails.refresh_token,tokenDetails:e.tokenDetails};p(r,"zoom_fetch_all_fields").then(i=>{a(!1),i&&i.success&&(t(s=>$(s,n=>{n.zoomFields=i.data,n.field_map=R(n.zoomFields)})),o({show:!0,msg:l("Zoom fields refreshed","bit-integrations")})),o({show:!0,msg:i!=null&&i.data?i==null?void 0:i.data:l("Zoom fields refreshed failed!","bit-integrations")})}).catch(()=>a(!1))},z=(e,t,a,o,r,i)=>{if(!e.clientId||!e.clientSecret){a({clientId:e.clientId?"":l("Client Id can't be empty","bit-integrations"),clientSecret:e.clientSecret?"":l("Secret key can't be empty","bit-integrations")});return}r(!0);const s=`https://zoom.us/oauth/authorize?response_type=code&client_id=${e.clientId}&state=${encodeURIComponent(window.location.href)}/redirect&redirect_uri=${encodeURIComponent(`${btcbi.api.base}/redirect`)}`,n=window.open(s,"zoom","width=400,height=609,toolbar=off"),h=setInterval(()=>{if(n.closed){clearInterval(h);let c={},g=!1;const m=localStorage.getItem("__zoom");if(m&&(g=!0,c=JSON.parse(m),localStorage.removeItem("__zoom")),!c.code||c.error||!c||!g){const f=c.error?`Cause: ${c.error}`:"";i({show:!0,msg:`${l("Authorization failed","bit-integrations")} ${f}. ${l("please try again","bit-integrations")}`}),r(!1)}else{const f=d({},e);f.accountServer=c["accounts-server"],M(c,f,t,o,r,i)}}},500)},M=(e,t,a,o,r,i)=>{const s=d({},e);s.clientId=t.clientId,s.clientSecret=t.clientSecret,s.redirectURI=`${btcbi.api.base}/redirect`,p(s,"zoom_generate_token").then(n=>n).then(n=>{if(n&&n.success){const h=d({},t);h.tokenDetails=n.data,a(h),o(!0),i({show:!0,msg:l("Authorized Successfully","bit-integrations")})}else n&&n.data&&n.data.data||!n.success&&typeof n.data=="string"?i({show:!0,msg:`${l("Authorization failed Cause:","bit-integrations")}${n.data.data||n.data}. ${l("please try again","bit-integrations")}`}):i({show:!0,msg:l("Authorization failed. please try again","bit-integrations")});r(!1)})},P=e=>!((e.field_map?e.field_map.filter(a=>!a.formField&&!a.zoomConf):[]).length>0),R=(e=[])=>{const t=e==null?void 0:e.filter(a=>a.required===!0);return t.length>0?t.map(a=>({formField:"",zoomField:a.key})):[{formField:"",zoomField:""}]};export{z as a,P as c,D as h,I as r,q as s,v as z};
