var _=Object.defineProperty;var N=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var v=(r,t,l)=>t in r?_(r,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[t]=l,k=(r,t)=>{for(var l in t||(t={}))A.call(t,l)&&v(r,l,t[l]);if(N)for(var l of N(t))D.call(t,l)&&v(r,l,t[l]);return r};var j=(r,t,l)=>new Promise((e,d)=>{var a=i=>{try{o(l.next(i))}catch(n){d(n)}},p=i=>{try{o(l.throw(i))}catch(n){d(n)}},o=i=>i.done?e(i.value):Promise.resolve(i.value).then(a,p);o((l=l.apply(r,t)).next())});import{f as $,j as s,L as z}from"./main-748.js";import{c as x,_ as h,s as S,d as W}from"./bi.597.0.js";import{h as F,a as H,b as I,d as U}from"./bi.322.755.js";import{y as O,u as M}from"./bi.872.446.js";import{T as P}from"./bi.212.11.js";import{a as E}from"./bi.441.3.js";import{T as G}from"./bi.736.731.js";const ee=(r,t,l,e,d,a,p,o,i)=>{let n=k({},t);if(p){const u=k({},o);u[r.target.name]="",i(k({},u))}switch(n[r.target.name]=r.target.value,r.target.name){case"spreadsheetId":n=q(n,e,l,d,a);break;case"worksheetName":n=V(n,e,l,d,a);break}l(k({},n))},q=(r,t,l,e,d)=>{var p,o,i,n,u,m,c,g,b;const a=O(r);return a.worksheetName="",a.headerRow="A1",a.field_map=[{formField:"",googleSheetField:""}],(o=(p=a==null?void 0:a.default)==null?void 0:p.worksheets)!=null&&o[r.spreadsheetId]?Object.keys((n=(i=a==null?void 0:a.default)==null?void 0:i.worksheets)==null?void 0:n[r.spreadsheetId]).length===1&&(a.worksheetName=(m=(u=a==null?void 0:a.default)==null?void 0:u.worksheets)==null?void 0:m[r.spreadsheetId][0].properties.title,(b=(g=(c=a==null?void 0:a.default)==null?void 0:c.worksheets)==null?void 0:g.headers)!=null&&b[a.worksheetName]||f(t,a,l,e,d)):R(t,a,l,e,d),a},V=(r,t,l,e,d)=>{var p,o,i;const a=k({},r);return a.headerRow="A1",a.field_map=[{formField:"",googleSheetField:""}],(i=(o=(p=a==null?void 0:a.default)==null?void 0:p.worksheets)==null?void 0:o.headers)!=null&&i[r.worksheetName]||f(t,a,l,e,d),a},B=(r,t,l,e,d)=>{var o;const a=!((o=t.tokenDetails)!=null&&o.selectedAuthType)||t.tokenDetails.selectedAuthType==="Custom Authorization",p={formID:r,id:t.id,clientId:a?t.clientId:t.oneClickAuthCredentials.clientId,clientSecret:a?t.clientSecret:t.oneClickAuthCredentials.clientSecret,tokenDetails:t.tokenDetails,ownerEmail:t.ownerEmail};e(!0),x(p,"gsheet_refresh_spreadsheets").then(i=>{if(i&&i.success){const n=k({},t);n.default||(n.default={}),i.data.spreadsheets&&(n.default.spreadsheets=i.data.spreadsheets),i.data.tokenDetails&&(n.tokenDetails=i.data.tokenDetails),d({show:!0,msg:h("Spreadsheet refreshed","bit-integrations")}),l(k({},n))}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?d({show:!0,msg:S(h("Spreadsheet refresh failed Cause: %s. please try again","bit-integrations"),i.data.data||i.data)}):d({show:!0,msg:h("Spreadsheet refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},R=(r,t,l,e,d)=>{const{spreadsheetId:a}=t;if(!a)return;e(!0);const p={formID:r,spreadsheetId:a,tokenDetails:t.tokenDetails};x(p,"gsheet_refresh_worksheets").then(o=>{if(o&&o.success){const i=k({},t);o.data.worksheets&&(i.default.worksheets||(i.default.worksheets={}),i.default.worksheets[a]=o.data.worksheets),o.data.tokenDetails&&(i.tokenDetails=o.data.tokenDetails),d({show:!0,msg:h("Worksheets refreshed","bit-integrations")}),l(k({},i))}else d({show:!0,msg:h("Worksheets refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},f=(r,t,l,e,d)=>{var m;const{spreadsheetId:a,worksheetName:p,header:o,headerRow:i}=t;if(!a&&!p&&!o&&!i)return;e(!0);const n=!((m=t.tokenDetails)!=null&&m.selectedAuthType)||t.tokenDetails.selectedAuthType==="Custom Authorization",u={formID:r,spreadsheetId:a,worksheetName:p,header:o,headerRow:i,clientId:n?t.clientId:t.oneClickAuthCredentials.clientId,clientSecret:n?t.clientSecret:t.oneClickAuthCredentials.clientSecret,tokenDetails:t.tokenDetails};x(u,"gsheet_refresh_worksheet_headers").then(c=>{var g;if(c&&c.success){const b=k({},t);((g=c.data.worksheet_headers)==null?void 0:g.length)>0?(b.default.headers||(b.default.headers={}),b.default.headers[a]||(b.default.headers[a]={}),b.default.headers[a][p]||(b.default.headers[a][p]={}),b.default.headers[a][p][i]=c.data.worksheet_headers,c.data.tokenDetails&&(b.tokenDetails=c.data.tokenDetails),d({show:!0,msg:h("Worksheet Headers refreshed","bit-integrations")})):d({show:!0,msg:h("No Worksheet headers found. Try changing the header row number or try again","bit-integrations")}),c.data.tokenDetails&&(b.tokenDetails=c.data.tokenDetails),l(k({},b))}else d({show:!0,msg:h("Worksheet Headers refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},te=(r,t,l,e)=>{let d="";if(t==="One Click Authorization")d=r.oneClickAuthCredentials.clientId;else if(t==="Custom Authorization"){if(!r.clientId||!r.clientSecret){l({clientId:r.clientId?"":h("Client Id can't be empty","bit-integrations"),clientSecret:r.clientSecret?"":h("Secret key can't be empty","bit-integrations")});return}d=r.clientId}e(!0);const a="https://www.googleapis.com/auth/drive",o=t==="One Click Authorization"?"https://auth-apps.bitapps.pro/redirect/v2":`${btcbi.api.base}/redirect`,{href:i,hash:n}=window.location,u=n?i.replace(n,"#/auth-response/"):`${i}#/auth-response/`,m=`https://accounts.google.com/o/oauth2/v2/auth?scope=${a}&access_type=offline&prompt=consent&response_type=code&state=${encodeURIComponent(u)}&redirect_uri=${encodeURIComponent(o)}&client_id=${d}`,c=window.open(m,"googleSheet","width=400,height=609,toolbar=off");if(t==="Custom Authorization"){const g=setInterval(()=>{c.closed&&(clearInterval(g),e(!1))},500)}},ae=(r,t,l,e,d,a,p,o,i)=>j(void 0,null,function*(){if(!d)return;const n={};n.code=r.code||"",n.clientId=d==="One Click Authorization"?t.oneClickAuthCredentials.clientId:t.clientId,n.clientSecret=d==="One Click Authorization"?t.oneClickAuthCredentials.clientSecret:t.clientSecret;const u="https://auth-apps.bitapps.pro/redirect/v2";n.redirectURI=d==="One Click Authorization"?u:`${btcbi.api.base}/redirect`,o(!0),yield x(n,"gsheet_generate_token").then(m=>m).then(m=>j(void 0,null,function*(){m&&m.success?(l(c=>M(c,g=>{g.tokenDetails=m.data})),e(!0),i({show:!0,msg:h("Authorized Successfully","bit-integrations")})):m&&m.data&&m.data.data||!m.success&&typeof m.data=="string"?i({show:!0,msg:`${h("Authorization failed Cause:","bit-integrations")}${m.data.data||m.data}. ${h("please try again","bit-integrations")}`}):i({show:!0,msg:h("Authorization failed. please try again","bit-integrations")}),o(!1)}))}),se=r=>!((r.field_map?r.field_map.filter(l=>!l.formField&&!l.googleSheetField):[]).length>0);function J({i:r,formFields:t,field:l,sheetConf:e,setSheetConf:d}){var o,i,n,u,m;const a=$(W),{isPro:p}=a;return s.jsxs("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:[s.jsxs("div",{className:"flx integ-fld-wrp",children:[s.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:l.formField||"",onChange:c=>F(c,r,e,d),children:[s.jsx("option",{value:"",children:h("Select Field","bit-integrations")}),s.jsx("optgroup",{label:h("Form Fields","bit-integrations"),children:t.map(c=>s.jsx("option",{value:c.name,children:c.label},`ff-zhcrm-${c.name}`))}),s.jsx("option",{value:"custom",children:h("Custom...","bit-integrations")}),s.jsx("optgroup",{label:`${h("General Smart Codes","bit-integrations")} ${p?"":`(${h("Pro","bit-integrations")})`}`,children:p&&((o=E)==null?void 0:o.map(c=>s.jsx("option",{value:c.name,children:c.label},`ff-rm-${c.name}`)))})]}),l.formField==="custom"&&s.jsx(G,{onChange:c=>H(c,r,e,d),label:h("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:l.customValue||"",placeholder:h("Custom Value","bit-integrations"),formFields:t}),s.jsxs("select",{className:"btcd-paper-inp",name:"googleSheetField",value:l.googleSheetField||"",onChange:c=>F(c,r,e,d),children:[s.jsx("option",{value:"",children:h("Select Field","bit-integrations")}),((m=(u=(n=(i=e.default)==null?void 0:i.headers)==null?void 0:n[e.spreadsheetId])==null?void 0:u[e.worksheetName])==null?void 0:m[e.headerRow])&&Object.values(e.default.headers[e.spreadsheetId][e.worksheetName][e.headerRow]).map((c,g)=>s.jsx("option",{value:c,children:c.replace(`_${g}`,"")},`gsheet-${g*2}`))]})]}),s.jsx("button",{onClick:()=>I(r,e,d),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),s.jsx("button",{onClick:()=>U(r,e,d),className:"icn-btn sh-sm ml-1",type:"button","aria-label":"btn",children:s.jsx(P,{})})]})}function ie({formID:r,formFields:t,handleInput:l,sheetConf:e,setSheetConf:d,isLoading:a,setIsLoading:p,setSnackbar:o}){var i,n,u,m,c,g,b;return s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsx("b",{className:"wdt-200 d-in-b",children:h("Spreadsheets:","bit-integrations")}),s.jsxs("select",{onChange:l,name:"spreadsheetId",value:e.spreadsheetId,className:"btcd-paper-inp w-5",children:[s.jsx("option",{value:"",children:h("Select Spreadsheet","bit-integrations")}),((i=e==null?void 0:e.default)==null?void 0:i.spreadsheets)&&Object.keys(e.default.spreadsheets).map(w=>s.jsx("option",{value:e.default.spreadsheets[w].spreadsheetId,children:e.default.spreadsheets[w].spreadsheetName},w))]}),s.jsx("button",{onClick:()=>B(r,e,d,p,o),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":'"Refresh Spreadsheet"'},type:"button",disabled:a,children:"â†»"}),s.jsx("br",{}),s.jsx("br",{}),e.spreadsheetId&&s.jsxs(s.Fragment,{children:[s.jsx("b",{className:"wdt-200 d-in-b",children:"Worksheet:"}),s.jsxs("select",{onChange:l,name:"worksheetName",value:e.worksheetName,className:"btcd-paper-inp w-5",children:[s.jsx("option",{value:"",children:h("Select Worksheet","bit-integrations")}),((u=(n=e==null?void 0:e.default)==null?void 0:n.worksheets)==null?void 0:u[e.spreadsheetId])&&e.default.worksheets[e.spreadsheetId].map(w=>s.jsx("option",{value:w.properties.title,children:w.properties.title},w.properties.sheetId))]}),s.jsx("button",{onClick:()=>R(r,e,d,p,o),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":'"Refresh Sheet Worksheets"'},type:"button",disabled:a,children:"â†»"})]}),s.jsx("br",{}),s.jsx("br",{}),e.spreadsheetId&&e.worksheetName&&s.jsxs(s.Fragment,{children:[s.jsx("b",{className:"wdt-200 d-in-b",children:h("Header Row:","bit-integrations")}),s.jsx("input",{type:"text",min:"1",className:"btcd-paper-inp w-5",placeholder:"Header Row",onChange:l,value:e.headerRow,name:"headerRow"}),s.jsx("button",{onClick:()=>f(r,e,d,p,o),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":'"Refresh Worksheet Headers"'},type:"button",disabled:a,children:"â†»"}),s.jsx("br",{}),s.jsx("small",{className:"mt-3 d-blk w-5",style:{marginLeft:200,lineHeight:1.8,textAlign:"justify"},children:h("By default, first row of the worksheet is considered as header row. This can be used if tabular data starts from any row other than the first row.","bit-integrations")})]}),a&&s.jsx(z,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),((b=(g=(c=(m=e.default)==null?void 0:m.headers)==null?void 0:c[e.spreadsheetId])==null?void 0:g[e.worksheetName])==null?void 0:b[e.headerRow])&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-4",children:s.jsx("b",{className:"wdt-100",children:h("Map Fields","bit-integrations")})}),s.jsx("div",{className:"btcd-hr mt-1"}),s.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:h("Form Fields","bit-integrations")})}),s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:h("Google Fields","bit-integrations")})})]}),e.field_map.map((w,y)=>s.jsx(J,{i:y,field:w,sheetConf:e,formFields:t,setSheetConf:d},`sheet-m-${y+9}`)),s.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",children:s.jsx("button",{onClick:()=>I(e.field_map.length,e,d),className:"icn-btn sh-sm",type:"button",children:"+"})}),s.jsx("br",{}),s.jsx("br",{})]})]})}export{ie as G,te as a,se as c,ee as h,B as r,ae as t};
