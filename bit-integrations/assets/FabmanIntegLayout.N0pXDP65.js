var D=Object.defineProperty,V=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var y=(i,e,l)=>e in i?D(i,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[e]=l,m=(i,e)=>{for(var l in e||(e={}))R.call(e,l)&&y(i,l,e[l]);if(k)for(var l of k(e))z.call(e,l)&&y(i,l,e[l]);return i},j=(i,e)=>V(i,$(e));import{k as A,g as M,j as t,_ as c,L}from"./main.2.7.9.js";import{d as x}from"./react-router-dom.BLIKw1eE.js";import{u as _,a9 as v}from"./Note.B1QjZ60t.js";import{a as T,h as U}from"./Integrations.CEc3UakZ.js";import{T as P}from"./TagifyInput.BafnMlYq.js";import{f as Y}from"./FabmanCommonFunc.DYKXUxTf.js";const q=(i,e,l)=>{const s=_(e,a=>{a.field_map.splice(i,0,{})});l(s)},E=(i,e,l)=>{const s=_(e,a=>{a.field_map.length>1&&a.field_map.splice(i,1)});l(s)},S=(i,e,l,s)=>{const a=_(l,d=>{d.field_map[e]||(d.field_map[e]={}),d.field_map[e][i.target.name]=i.target.value,i.target.value==="custom"?d.field_map[e].customValue="":delete d.field_map[e].customValue});s(a)};function w({i,formFields:e,field:l,fabmanConf:s,setFabmanConf:a}){var g;const d=x.useMemo(()=>s!=null&&s.staticFields?s.staticFields.filter(r=>!!r.required):[],[s==null?void 0:s.staticFields]),p=x.useMemo(()=>s!=null&&s.staticFields?s.staticFields.filter(r=>!r.required):[],[s==null?void 0:s.staticFields]),h=x.useMemo(()=>Array.isArray(s.customFields)?s.customFields:[],[s.customFields]),F=x.useMemo(()=>[...p,...h],[p,h]),N=A(M),{isPro:b}=N,u=x.useMemo(()=>Array.isArray(s==null?void 0:s.field_map)&&s.field_map.length<=1,[s==null?void 0:s.field_map]);return t.jsx("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:t.jsxs("div",{className:"pos-rel flx",children:[t.jsxs("div",{className:"flx integ-fld-wrp",children:[t.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:l.formField||"",onChange:r=>S(r,i,s,a),children:[t.jsx("option",{value:"",children:c("Select Field","bit-integrations")}),t.jsx("optgroup",{label:c("Form Fields","bit-integrations"),children:e==null?void 0:e.map(r=>t.jsx("option",{value:r.name,children:r.label},`ff-rm-${r.name}`))}),t.jsx("option",{value:"custom",children:c("Custom...","bit-integrations")}),b&&t.jsx("optgroup",{label:c("General Smart Codes","bit-integrations"),children:(g=T)==null?void 0:g.map(r=>t.jsx("option",{value:r.name,children:r.label},`ff-rm-${r.name}`))})]}),l.formField==="custom"&&t.jsx(P,{onChange:r=>U(r,i,s,a),label:c("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:l.customValue,placeholder:c("Custom Value","bit-integrations"),formFields:e}),t.jsxs("select",{className:"btcd-paper-inp",disabled:i<d.length,name:"fabmanFormField",value:i<d.length?d[i].key||"":l.fabmanFormField||"",onChange:r=>S(r,i,s,a),children:[t.jsx("option",{value:"",children:c("Select Field","bit-integrations")}),i<d.length?t.jsx("option",{value:d[i].key,children:d[i].label},d[i].key):F.map(({key:r,label:o})=>t.jsx("option",{value:r,children:o},r))]})]}),i>=d.length&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>q(i,s,a),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),t.jsxs("div",{className:"pos-rel delete-field-wrapper",style:{position:"relative"},children:[t.jsx("button",{onClick:()=>E(i,s,a),disabled:u,className:`icn-btn sh-sm ml-1 ${u?"btcd-icn-disabled":""}`,type:"button","aria-label":"Delete field mapping",title:u?c("At least one field mapping is required","bit-integrations"):c("Delete field mapping","bit-integrations"),children:t.jsx("span",{className:"btcd-icn icn-trash-2"})}),u&&t.jsx("div",{className:"delete-tooltip",style:{position:"absolute",top:"calc(100% + 8px)",left:"50%",transform:"translateX(-50%)",background:"rgba(0, 0, 0, 0.9)",color:"white",padding:"8px 12px",borderRadius:"6px",fontSize:"12px",whiteSpace:"nowrap",zIndex:1e3,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",border:"1px solid rgba(255,255,255,0.1)",maxWidth:"200px"},children:c("At least one field mapping is required","bit-integrations")})]})]})]})})}const G=[{label:c("Create Member","bit-integrations"),value:"create_member",is_pro:!1},{label:c("Update Member","bit-integrations"),value:"update_member",is_pro:!0},{label:c("Delete Member","bit-integrations"),value:"delete_member",is_pro:!0},{label:c("Create Spaces","bit-integrations"),value:"create_spaces",is_pro:!0},{label:c("Update Spaces","bit-integrations"),value:"update_spaces",is_pro:!0}],W=i=>{if(i.actionName==="create_spaces"||i.actionName==="update_spaces"){const e=Array.isArray(i.spacesStaticFields)?i.spacesStaticFields.map(d=>m({},d)):[],l=i.actionName==="create_spaces",s=e.findIndex(d=>String(d.key)==="name");s>-1&&(e[s].required=!0);const a=e.findIndex(d=>String(d.key)==="timezone");return a>-1&&(e[a].required=l),e}if(i.actionName==="update_member"||i.actionName==="delete_member"){const e=Array.isArray(i.memberStaticFields)?i.memberStaticFields.map(a=>m({},a)):[],l=e.findIndex(a=>String(a.key)==="emailAddress");l>-1&&(e[l].required=!0);const s=e.findIndex(a=>String(a.key)==="firstName");return s>-1&&(e[s].required=!1),e}return i.memberStaticFields},X=(i,e)=>{const s=(W(i)||[]).filter(p=>!!p.required);if(!Array.isArray(i.field_map))return;let a=!1;const d=[...i.field_map];for(let p=0;p<s.length;p+=1)d[p]?d[p].fabmanFormField!==s[p].key&&(d[p]=j(m({},d[p]),{fabmanFormField:s[p].key}),a=!0):(d[p]={formField:"",fabmanFormField:s[p].key},a=!0);if(a){const p=j(m({},i),{field_map:d});e(p)}};function te({formFields:i,fabmanConf:e,setFabmanConf:l,loading:s,setLoading:a,setSnackbar:d}){var g;const p=A(M),{isPro:h}=p,F=r=>{const o=m({},e),n=r.target.value;o.actionName=n,(n==="create_spaces"||n==="update_spaces")&&(delete o.selectedMember,delete o.selectedLockVersion),o.field_map=[{formField:"",fabmanFormField:""}],l(o),X(o,l)},N=r=>{const o=m({},e);o.selectedWorkspace=r.target.value;const n=((e==null?void 0:e.workspaces)||[]).find(I=>String(I.id)===String(r.target.value));n&&typeof n.lockVersion!="undefined"&&(o.selectedLockVersion=n.lockVersion),l(o)},b=()=>{Y(e,l,s,a,"refresh")},u=x.useMemo(()=>W(e),[e]);return t.jsxs("div",{children:[t.jsx("br",{}),t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:c("Action:","bit-integrations")}),t.jsxs("select",{onChange:F,name:"actionName",value:e==null?void 0:e.actionName,className:"btcd-paper-inp w-5",children:[t.jsx("option",{value:"",children:c("Select Action","bit-integrations")}),G.map(({label:r,value:o,is_pro:n})=>t.jsxs("option",{value:o,disabled:n&&!h,children:[r,n&&!h?` (${c("Pro","bit-integrations")})`:""]},o))]})]}),t.jsx("br",{}),e.actionName&&e.actionName!=="delete_member"&&e.actionName!=="create_spaces"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flx",children:[t.jsx("b",{className:"wdt-200 d-in-b",children:c("Select Workspace:","bit-integrations")}),t.jsxs("select",{onChange:N,name:"selectedWorkspace",value:(e==null?void 0:e.selectedWorkspace)||"",className:"btcd-paper-inp w-5",disabled:s.workspaces,children:[t.jsx("option",{value:"",children:c("Select Workspace","bit-integrations")}),(g=e==null?void 0:e.workspaces)==null?void 0:g.map(r=>t.jsx("option",{value:r.id,children:r.name},r.id))]}),t.jsx("button",{onClick:b,className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":`'${c("Refresh Workspaces","bit-integrations")}'`},type:"button",disabled:s.workspaces,children:"â†»"})]}),s.workspaces&&t.jsx(L,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:50,transform:"scale(0.7)"}}),t.jsx("br",{}),t.jsx(v,{note:B})]}),e.actionName==="delete_member"&&t.jsxs(t.Fragment,{children:[t.jsx(v,{note:J}),t.jsx("div",{className:"mt-5",children:t.jsx("b",{className:"wdt-100",children:c("Field Map","bit-integrations")})}),t.jsx("br",{}),t.jsx("div",{className:"btcd-hr mt-1"}),t.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:c("Form Fields","bit-integrations")})}),t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:c("Fabman Fields","bit-integrations")})})]}),t.jsx(w,{i:0,field:e.field_map[0]||{formField:"",fabmanFormField:"emailAddress"},fabmanConf:j(m({},e),{staticFields:[{key:"emailAddress",label:c("Email Address","bit-integrations"),required:!0}]}),formFields:i,setFabmanConf:l,setSnackbar:d})]}),e.actionName&&e.actionName!=="delete_member"&&(e.actionName==="create_member"||e.actionName==="update_member"||e.actionName==="create_spaces"&&e.selectedWorkspace||e.actionName==="update_spaces"&&e.selectedWorkspace)&&t.jsxs(t.Fragment,{children:[e.actionName==="create_spaces"&&t.jsx(v,{note:H}),t.jsx("div",{className:"mt-5",children:t.jsx("b",{className:"wdt-100",children:c("Field Map","bit-integrations")})}),t.jsx("br",{}),t.jsx("div",{className:"btcd-hr mt-1"}),t.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:c("Form Fields","bit-integrations")})}),t.jsx("div",{className:"txt-dp",children:t.jsx("b",{children:c("Fabman Fields","bit-integrations")})})]}),e==null?void 0:e.field_map.map((r,o)=>t.jsx(w,{i:o,field:r,fabmanConf:j(m({},e),{staticFields:u}),formFields:i,setFabmanConf:l,setSnackbar:d},`rp-m-${o+9}`)),t.jsxs("div",{children:[t.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",children:t.jsx("button",{onClick:()=>q(e.field_map.length,e,l),className:"icn-btn sh-sm",type:"button",children:"+"})}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("div",{className:"mt-4",children:t.jsx("b",{className:"wdt-100",children:c("Utilities","bit-integrations")})}),t.jsx("div",{className:"btcd-hr mt-1"})]})]})]})}const B=`<h4>${c("Please select workspace for Create Member, Update Member, and Update Spaces.","bit-integrations")}</h4>`,H=`<h4>${c("For Create Spaces, Timezone must be like Asia/Dhaka (IANA timezone format).","bit-integrations")}</h4>`,J=`<h4>${c("For Delete Member, datetime format must be YYYY-MM-DD.","bit-integrations")}</h4>`;export{te as F};
