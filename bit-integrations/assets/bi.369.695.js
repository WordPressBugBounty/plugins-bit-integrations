var _=Object.defineProperty;var N=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var I=(r,t,l)=>t in r?_(r,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[t]=l,k=(r,t)=>{for(var l in t||(t={}))A.call(t,l)&&I(r,l,t[l]);if(N)for(var l of N(t))D.call(t,l)&&I(r,l,t[l]);return r};var x=(r,t,l)=>new Promise((e,d)=>{var a=i=>{try{n(l.next(i))}catch(c){d(c)}},m=i=>{try{n(l.throw(i))}catch(c){d(c)}},n=i=>i.done?e(i.value):Promise.resolve(i.value).then(a,m);n((l=l.apply(r,t)).next())});import{f as $,j as s,L as z}from"./main-247.js";import{c as f,_ as p,s as S,e as W}from"./bi.456.0.js";import{h as v,a as U,b as F,d as H}from"./bi.335.696.js";import{x as M}from"./bi.393.437.js";import{h as O}from"./bi.105.697.js";import{T as E}from"./bi.923.11.js";import{a as P}from"./bi.427.3.js";import{T as G}from"./bi.510.673.js";const ae=(r,t,l,e,d,a,m,n,i)=>{let c=k({},t);if(m){const h=k({},n);h[r.target.name]="",i(k({},h))}switch(c[r.target.name]=r.target.value,r.target.name){case"spreadsheetId":c=q(c,e,l,d,a);break;case"worksheetName":c=V(c,e,l,d,a);break}l(k({},c))},q=(r,t,l,e,d)=>{var m,n,i,c,h,b,o,u,g;const a=M(r);return a.worksheetName="",a.headerRow="A1",a.field_map=[{formField:"",googleSheetField:""}],(n=(m=a==null?void 0:a.default)==null?void 0:m.worksheets)!=null&&n[r.spreadsheetId]?Object.keys((c=(i=a==null?void 0:a.default)==null?void 0:i.worksheets)==null?void 0:c[r.spreadsheetId]).length===1&&(a.worksheetName=(b=(h=a==null?void 0:a.default)==null?void 0:h.worksheets)==null?void 0:b[r.spreadsheetId][0].properties.title,(g=(u=(o=a==null?void 0:a.default)==null?void 0:o.worksheets)==null?void 0:u.headers)!=null&&g[a.worksheetName]||j(t,a,l,e,d)):R(t,a,l,e,d),a},V=(r,t,l,e,d)=>{var m,n,i;const a=k({},r);return a.headerRow="A1",a.field_map=[{formField:"",googleSheetField:""}],(i=(n=(m=a==null?void 0:a.default)==null?void 0:m.worksheets)==null?void 0:n.headers)!=null&&i[r.worksheetName]||j(t,a,l,e,d),a},B=(r,t,l,e,d)=>{var n;const a=!((n=t.tokenDetails)!=null&&n.selectedAuthType)||t.tokenDetails.selectedAuthType==="Custom Authorization",m={formID:r,id:t.id,clientId:a?t.clientId:t.oneClickAuthCredentials.clientId,clientSecret:a?t.clientSecret:t.oneClickAuthCredentials.clientSecret,tokenDetails:t.tokenDetails,ownerEmail:t.ownerEmail};e(!0),f(m,"gsheet_refresh_spreadsheets").then(i=>{if(i&&i.success){const c=k({},t);c.default||(c.default={}),i.data.spreadsheets&&(c.default.spreadsheets=i.data.spreadsheets),i.data.tokenDetails&&(c.tokenDetails=i.data.tokenDetails),d({show:!0,msg:p("Spreadsheet refreshed","bit-integrations")}),l(k({},c))}else i&&i.data&&i.data.data||!i.success&&typeof i.data=="string"?d({show:!0,msg:S(p("Spreadsheet refresh failed Cause: %s. please try again","bit-integrations"),i.data.data||i.data)}):d({show:!0,msg:p("Spreadsheet refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},R=(r,t,l,e,d)=>{const{spreadsheetId:a}=t;if(!a)return;e(!0);const m={formID:r,spreadsheetId:a,tokenDetails:t.tokenDetails};f(m,"gsheet_refresh_worksheets").then(n=>{if(n&&n.success){const i=k({},t);n.data.worksheets&&(i.default.worksheets||(i.default.worksheets={}),i.default.worksheets[a]=n.data.worksheets),n.data.tokenDetails&&(i.tokenDetails=n.data.tokenDetails),d({show:!0,msg:p("Worksheets refreshed","bit-integrations")}),l(k({},i))}else d({show:!0,msg:p("Worksheets refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},j=(r,t,l,e,d)=>{var b;const{spreadsheetId:a,worksheetName:m,header:n,headerRow:i}=t;if(!a&&!m&&!n&&!i)return;e(!0);const c=!((b=t.tokenDetails)!=null&&b.selectedAuthType)||t.tokenDetails.selectedAuthType==="Custom Authorization",h={formID:r,spreadsheetId:a,worksheetName:m,header:n,headerRow:i,clientId:c?t.clientId:t.oneClickAuthCredentials.clientId,clientSecret:c?t.clientSecret:t.oneClickAuthCredentials.clientSecret,tokenDetails:t.tokenDetails};f(h,"gsheet_refresh_worksheet_headers").then(o=>{var u;if(o&&o.success){const g=k({},t);((u=o.data.worksheet_headers)==null?void 0:u.length)>0?(g.default.headers||(g.default.headers={}),g.default.headers[a]||(g.default.headers[a]={}),g.default.headers[a][m]||(g.default.headers[a][m]={}),g.default.headers[a][m][i]=o.data.worksheet_headers,o.data.tokenDetails&&(g.tokenDetails=o.data.tokenDetails),d({show:!0,msg:p("Worksheet Headers refreshed","bit-integrations")})):d({show:!0,msg:p("No Worksheet headers found. Try changing the header row number or try again","bit-integrations")}),o.data.tokenDetails&&(g.tokenDetails=o.data.tokenDetails),l(k({},g))}else d({show:!0,msg:p("Worksheet Headers refresh failed. please try again","bit-integrations")});e(!1)}).catch(()=>e(!1))},se=(r,t,l,e)=>{let d="";if(t==="One Click Authorization")d=r.oneClickAuthCredentials.clientId;else if(t==="Custom Authorization"){if(!r.clientId||!r.clientSecret){l({clientId:r.clientId?"":p("Client Id can't be empty","bit-integrations"),clientSecret:r.clientSecret?"":p("Secret key can't be empty","bit-integrations")});return}d=r.clientId}e(!0);const a="https://www.googleapis.com/auth/drive",n=t==="One Click Authorization"?"https://auth-apps.bitapps.pro/redirect/v2":`${btcbi.api.base}/redirect`,{href:i,hash:c}=window.location,h=c?i.replace(c,"#/auth-response/"):`${i}#/auth-response/`,b=`https://accounts.google.com/o/oauth2/v2/auth?scope=${a}&access_type=offline&prompt=consent&response_type=code&state=${encodeURIComponent(h)}&redirect_uri=${encodeURIComponent(n)}&client_id=${d}`,o=window.open(b,"googleSheet","width=400,height=609,toolbar=off");if(t==="Custom Authorization"){const u=setInterval(()=>{o.closed&&(clearInterval(u),e(!1))},500)}},ie=(r,t,l,e,d,a,m,n)=>x(void 0,null,function*(){if(!e)return;const i={};i.code=r.code||"",i.clientId=e==="One Click Authorization"?t.oneClickAuthCredentials.clientId:t.clientId,i.clientSecret=e==="One Click Authorization"?t.oneClickAuthCredentials.clientSecret:t.clientSecret;const c="https://auth-apps.bitapps.pro/redirect/v2";i.redirectURI=e==="One Click Authorization"?c:`${btcbi.api.base}/redirect`,m(!0),yield f(i,"gsheet_generate_token").then(h=>h).then(h=>x(void 0,null,function*(){if(h&&h.success){const b=yield J(h.data),o=d.some(u=>u.userInfo.user.emailAddress===b.user.emailAddress);if(b&&!o){const u=k({},t);h.data.selectedAuthType=e,yield O(u.type,h.data,b,a),u.authData=[...d,{tokenDetails:h.data,userInfo:b}],u.setisAuthorized=!0,l(u),n({show:!0,msg:p("Authorized Successfully","bit-integrations")})}else n({show:!0,msg:p("This account is already on the list.","bit-integrations")})}else h&&h.data&&h.data.data||!h.success&&typeof h.data=="string"?n({show:!0,msg:`${p("Authorization failed Cause:","bit-integrations")}${h.data.data||h.data}. ${p("please try again","bit-integrations")}`}):n({show:!0,msg:p("Authorization failed. please try again","bit-integrations")});m(!1)}))}),re=r=>!((r.field_map?r.field_map.filter(l=>!l.formField&&!l.googleSheetField):[]).length>0);function J(r){return x(this,null,function*(){const t=r.access_token;try{return yield(yield fetch("https://www.googleapis.com/drive/v3/about?fields=user",{headers:{Authorization:`Bearer ${t}`}})).json()}catch(l){console.error("Error fetching user info:",l)}})}function K({i:r,formFields:t,field:l,sheetConf:e,setSheetConf:d}){var n,i,c,h,b;const a=$(W),{isPro:m}=a;return s.jsxs("div",{className:"flx mt-2 mb-2 btcbi-field-map",children:[s.jsxs("div",{className:"flx integ-fld-wrp",children:[s.jsxs("select",{className:"btcd-paper-inp mr-2",name:"formField",value:l.formField||"",onChange:o=>v(o,r,e,d),children:[s.jsx("option",{value:"",children:p("Select Field","bit-integrations")}),s.jsx("optgroup",{label:p("Form Fields","bit-integrations"),children:t.map(o=>s.jsx("option",{value:o.name,children:o.label},`ff-zhcrm-${o.name}`))}),s.jsx("option",{value:"custom",children:p("Custom...","bit-integrations")}),s.jsx("optgroup",{label:`${p("General Smart Codes","bit-integrations")} ${m?"":`(${p("Pro","bit-integrations")})`}`,children:m&&((n=P)==null?void 0:n.map(o=>s.jsx("option",{value:o.name,children:o.label},`ff-rm-${o.name}`)))})]}),l.formField==="custom"&&s.jsx(G,{onChange:o=>U(o,r,e,d),label:p("Custom Value","bit-integrations"),className:"mr-2",type:"text",value:l.customValue||"",placeholder:p("Custom Value","bit-integrations"),formFields:t}),s.jsxs("select",{className:"btcd-paper-inp",name:"googleSheetField",value:l.googleSheetField||"",onChange:o=>v(o,r,e,d),children:[s.jsx("option",{value:"",children:p("Select Field","bit-integrations")}),((b=(h=(c=(i=e.default)==null?void 0:i.headers)==null?void 0:c[e.spreadsheetId])==null?void 0:h[e.worksheetName])==null?void 0:b[e.headerRow])&&Object.values(e.default.headers[e.spreadsheetId][e.worksheetName][e.headerRow]).map((o,u)=>s.jsx("option",{value:o,children:o},`gsheet-${u*2}`))]})]}),s.jsx("button",{onClick:()=>F(r,e,d),className:"icn-btn sh-sm ml-2 mr-1",type:"button",children:"+"}),s.jsx("button",{onClick:()=>H(r,e,d),className:"icn-btn sh-sm ml-1",type:"button","aria-label":"btn",children:s.jsx(E,{})})]})}function le({formID:r,formFields:t,handleInput:l,sheetConf:e,setSheetConf:d,isLoading:a,setIsLoading:m,setSnackbar:n}){var i,c,h,b,o,u,g;return s.jsxs(s.Fragment,{children:[s.jsx("br",{}),s.jsx("b",{className:"wdt-200 d-in-b",children:p("Spreadsheets:","bit-integrations")}),s.jsxs("select",{onChange:l,name:"spreadsheetId",value:e.spreadsheetId,className:"btcd-paper-inp w-5",children:[s.jsx("option",{value:"",children:p("Select Spreadsheet","bit-integrations")}),((i=e==null?void 0:e.default)==null?void 0:i.spreadsheets)&&Object.keys(e.default.spreadsheets).map(w=>s.jsx("option",{value:e.default.spreadsheets[w].spreadsheetId,children:e.default.spreadsheets[w].spreadsheetName},w))]}),s.jsx("button",{onClick:()=>B(r,e,d,m,n),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":'"Refresh Spreadsheet"'},type:"button",disabled:a,children:"â†»"}),s.jsx("br",{}),s.jsx("br",{}),e.spreadsheetId&&s.jsxs(s.Fragment,{children:[s.jsx("b",{className:"wdt-200 d-in-b",children:"Worksheet:"}),s.jsxs("select",{onChange:l,name:"worksheetName",value:e.worksheetName,className:"btcd-paper-inp w-5",children:[s.jsx("option",{value:"",children:p("Select Worksheet","bit-integrations")}),((h=(c=e==null?void 0:e.default)==null?void 0:c.worksheets)==null?void 0:h[e.spreadsheetId])&&e.default.worksheets[e.spreadsheetId].map(w=>s.jsx("option",{value:w.properties.title,children:w.properties.title},w.properties.sheetId))]}),s.jsx("button",{onClick:()=>R(r,e,d,m,n),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":'"Refresh Sheet Worksheets"'},type:"button",disabled:a,children:"â†»"})]}),s.jsx("br",{}),s.jsx("br",{}),e.spreadsheetId&&e.worksheetName&&s.jsxs(s.Fragment,{children:[s.jsx("b",{className:"wdt-200 d-in-b",children:p("Header Row:","bit-integrations")}),s.jsx("input",{type:"text",min:"1",className:"btcd-paper-inp w-5",placeholder:"Header Row",onChange:l,value:e.headerRow,name:"headerRow"}),s.jsx("button",{onClick:()=>j(r,e,d,m,n),className:"icn-btn sh-sm ml-2 mr-2 tooltip",style:{"--tooltip-txt":'"Refresh Worksheet Headers"'},type:"button",disabled:a,children:"â†»"}),s.jsx("br",{}),s.jsx("small",{className:"mt-3 d-blk w-5",style:{marginLeft:200,lineHeight:1.8,textAlign:"justify"},children:p("By default, first row of the worksheet is considered as header row. This can be used if tabular data starts from any row other than the first row.","bit-integrations")})]}),a&&s.jsx(z,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:100,transform:"scale(0.7)"}}),((g=(u=(o=(b=e.default)==null?void 0:b.headers)==null?void 0:o[e.spreadsheetId])==null?void 0:u[e.worksheetName])==null?void 0:g[e.headerRow])&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-4",children:s.jsx("b",{className:"wdt-100",children:p("Map Fields","bit-integrations")})}),s.jsx("div",{className:"btcd-hr mt-1"}),s.jsxs("div",{className:"flx flx-around mt-2 mb-2 btcbi-field-map-label",children:[s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:p("Form Fields","bit-integrations")})}),s.jsx("div",{className:"txt-dp",children:s.jsx("b",{children:p("Google Fields","bit-integrations")})})]}),e.field_map.map((w,y)=>s.jsx(K,{i:y,field:w,sheetConf:e,formFields:t,setSheetConf:d},`sheet-m-${y+9}`)),s.jsx("div",{className:"txt-center btcbi-field-map-button mt-2",children:s.jsx("button",{onClick:()=>F(e.field_map.length,e,d),className:"icn-btn sh-sm",type:"button",children:"+"})}),s.jsx("br",{}),s.jsx("br",{})]})]})}export{le as G,se as a,re as c,ae as h,B as r,ie as t};
