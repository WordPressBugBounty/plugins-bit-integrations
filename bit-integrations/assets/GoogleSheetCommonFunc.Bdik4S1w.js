var b=Object.defineProperty;var _=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var y=(a,t,s)=>t in a?b(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,g=(a,t)=>{for(var s in t||(t={}))I.call(t,s)&&y(a,s,t[s]);if(_)for(var s of _(t))R.call(t,s)&&y(a,s,t[s]);return a};var w=(a,t,s)=>new Promise((d,h)=>{var e=o=>{try{i(s.next(o))}catch(n){h(n)}},r=o=>{try{i(s.throw(o))}catch(n){h(n)}},i=o=>o.done?d(o.value):Promise.resolve(o.value).then(e,r);i((s=s.apply(a,t)).next())});import{d as u,_ as p,s as F}from"./main.2.7.11.js";import{u as $,y as S}from"./Note.iI4FM_zT.js";const H=(a,t,s,d,h,e,r,i,o)=>{let n=g({},t);switch(n[a.target.name]=a.target.value,a.target.name){case"spreadsheetId":n=W(n,d,s,h,e);break;case"worksheetName":n=A(n,d,s,h,e);break}s(g({},n))},W=(a,t,s,d,h)=>{var r,i,o,n,l,c,f,k,m;const e=S(a);return e.worksheetName="",e.headerRow="A1",e.field_map=[{formField:"",googleSheetField:""}],(i=(r=e==null?void 0:e.default)==null?void 0:r.worksheets)!=null&&i[a.spreadsheetId]?Object.keys((n=(o=e==null?void 0:e.default)==null?void 0:o.worksheets)==null?void 0:n[a.spreadsheetId]).length===1&&(e.worksheetName=(c=(l=e==null?void 0:e.default)==null?void 0:l.worksheets)==null?void 0:c[a.spreadsheetId][0].properties.title,(m=(k=(f=e==null?void 0:e.default)==null?void 0:f.worksheets)==null?void 0:k.headers)!=null&&m[e.worksheetName]||D(t,e,s,d,h)):N(t,e,s,d,h),e},A=(a,t,s,d,h)=>{var r,i,o;const e=g({},a);return e.headerRow="A1",e.field_map=[{formField:"",googleSheetField:""}],(o=(i=(r=e==null?void 0:e.default)==null?void 0:r.worksheets)==null?void 0:i.headers)!=null&&o[a.worksheetName]||D(t,e,s,d,h),e},q=(a,t,s,d,h)=>{const e={formID:a,id:t.id,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails,ownerEmail:t.ownerEmail};d(!0),u(e,"gsheet_refresh_spreadsheets").then(r=>{if(r&&r.success){const i=g({},t);i.default||(i.default={}),r.data.spreadsheets&&(i.default.spreadsheets=r.data.spreadsheets),r.data.tokenDetails&&(i.tokenDetails=r.data.tokenDetails),h({show:!0,msg:p("Spreadsheet refreshed","bit-integrations")}),s(g({},i))}else r&&r.data&&r.data.data||!r.success&&typeof r.data=="string"?h({show:!0,msg:F(p("Spreadsheet refresh failed Cause: %s. please try again","bit-integrations"),r.data.data||r.data)}):h({show:!0,msg:p("Spreadsheet refresh failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},N=(a,t,s,d,h)=>{const{spreadsheetId:e}=t;if(!e)return;d(!0);const r={formID:a,spreadsheetId:e,tokenDetails:t.tokenDetails};u(r,"gsheet_refresh_worksheets").then(i=>{if(i&&i.success){const o=g({},t);i.data.worksheets&&(o.default.worksheets||(o.default.worksheets={}),o.default.worksheets[e]=i.data.worksheets),i.data.tokenDetails&&(o.tokenDetails=i.data.tokenDetails),h({show:!0,msg:p("Worksheets refreshed","bit-integrations")}),s(g({},o))}else h({show:!0,msg:p("Worksheets refresh failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},D=(a,t,s,d,h)=>{const{spreadsheetId:e,worksheetName:r,header:i,headerRow:o}=t;if(!e&&!r&&!i&&!o)return;d(!0);const n={formID:a,spreadsheetId:e,worksheetName:r,header:i,headerRow:o,clientId:t.clientId,clientSecret:t.clientSecret,tokenDetails:t.tokenDetails};u(n,"gsheet_refresh_worksheet_headers").then(l=>{var c;if(l&&l.success){const f=g({},t);((c=l.data.worksheet_headers)==null?void 0:c.length)>0?(f.default.headers||(f.default.headers={}),f.default.headers[e]||(f.default.headers[e]={}),f.default.headers[e][r]||(f.default.headers[e][r]={}),f.default.headers[e][r][o]=l.data.worksheet_headers,l.data.tokenDetails&&(f.tokenDetails=l.data.tokenDetails),h({show:!0,msg:p("Worksheet Headers refreshed","bit-integrations")})):h({show:!0,msg:p("No Worksheet headers found. Try changing the header row number or try again","bit-integrations")}),l.data.tokenDetails&&(f.tokenDetails=l.data.tokenDetails),s(g({},f))}else h({show:!0,msg:p("Worksheet Headers refresh failed. please try again","bit-integrations")});d(!1)}).catch(()=>d(!1))},E=(a,t,s,d,h)=>{if(!a.clientId||!a.clientSecret){s({clientId:a.clientId?"":p("Client Id can't be empty","bit-integrations"),clientSecret:a.clientSecret?"":p("Secret key can't be empty","bit-integrations")});return}const e=a.clientId;d(!0);const r="https://www.googleapis.com/auth/drive",i=`${h.api}/redirect`,{href:o,hash:n}=window.location,l=n?o.replace(n,"#/auth-response/"):`${o}#/auth-response/`,c=`https://accounts.google.com/o/oauth2/v2/auth?scope=${r}&access_type=offline&prompt=consent&response_type=code&state=${encodeURIComponent(l)}&redirect_uri=${encodeURIComponent(i)}&client_id=${e}`;console.log(h);const f=window.open(c,"googleSheet","width=400,height=609,toolbar=off");if(t==="Custom Authorization"){const k=setInterval(()=>{f.closed&&(clearInterval(k),d(!1))},500)}},P=(a,t,s,d,h,e,r,i,o,n)=>w(null,null,function*(){if(!h)return;const l={};l.code=a.code||"",l.clientId=t.clientId,l.clientSecret=t.clientSecret,l.redirectURI=`${n.api}/redirect`,i(!0),yield u(l,"gsheet_generate_token").then(c=>c).then(c=>w(null,null,function*(){c&&c.success?(s(f=>$(f,k=>{k.tokenDetails=c.data})),d(!0),o({show:!0,msg:p("Authorized Successfully","bit-integrations")})):c&&c.data&&c.data.data||!c.success&&typeof c.data=="string"?o({show:!0,msg:`${p("Authorization failed Cause:","bit-integrations")}${c.data.data||c.data}. ${p("please try again","bit-integrations")}`}):o({show:!0,msg:p("Authorization failed. please try again","bit-integrations")}),i(!1)}))}),M=a=>!((a.field_map?a.field_map.filter(s=>!s.formField&&!s.googleSheetField):[]).length>0);export{N as a,D as b,E as c,M as d,H as h,q as r,P as t};
